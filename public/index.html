<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniSentinal - UniFi Device Monitor</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-shield-alt"></i> UniSentinal</h1>
                <p>New Device Detection System</p>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Checking...</span>
                </div>
                <div class="header-controls">
                    <button id="darkModeToggle" class="btn-icon" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="settingsBtn" class="btn-icon" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" data-tab="monitoring">
                    <i class="fas fa-shield-alt"></i> Device Monitoring
                </button>
                <button class="tab-button" data-tab="parental">
                    <i class="fas fa-user-shield"></i> Parental Controls
                </button>
            </div>

            <!-- Device Monitoring Tab -->
            <div id="monitoring-tab" class="tab-content active">
                <div class="controls-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-plus-circle"></i>
                        <div class="stat-info">
                            <span class="stat-number" id="unacknowledgedCount">-</span>
                            <span class="stat-label">New Devices</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-day"></i>
                        <div class="stat-info">
                            <span class="stat-number" id="todayCount">-</span>
                            <span class="stat-label">Detected Today</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-network-wired"></i>
                        <div class="stat-info">
                            <span class="stat-number" id="totalKnownCount">-</span>
                            <span class="stat-label">Known Devices</span>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="scanBtn" class="btn btn-primary">
                        <i class="fas fa-radar"></i> Scan Network
                    </button>
                    <button id="refreshBtn" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="devices-section">
                <h2>Brand New Devices <span id="deviceCount" class="count-badge">0</span></h2>
                
                <div class="loading" id="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Scanning for new devices...
                </div>

                <div class="no-devices" id="noDevices" style="display: none;">
                    <i class="fas fa-shield-check"></i>
                    <p>No brand new devices detected</p>
                    <small>All devices are already known to your UniFi controller</small>
                </div>

                <div class="devices-grid" id="devicesGrid">
                    <!-- Device cards will be populated here -->
                </div>
            </div>

            <!-- Connection Diagnostics Accordion -->
            <div class="diagnostics-accordion">
                <button class="accordion-header" id="diagnosticsToggle">
                    <i class="fas fa-network-wired"></i>
                    <span>Connection Diagnostics</span>
                    <i class="fas fa-chevron-down accordion-icon"></i>
                </button>
                
                <div class="accordion-content" id="diagnosticsContent">
                    <div class="diagnostics-controls">
                        <button id="testConnectionBtn" class="btn btn-info btn-small">
                            <i class="fas fa-stethoscope"></i> Test Connection
                        </button>
                    </div>
                    
                    <div class="diagnostics-grid">
                        <div class="diagnostic-card">
                            <div class="diagnostic-header">
                                <i class="fas fa-plug diagnostic-icon" id="apiConnectionIcon"></i>
                                <span class="diagnostic-title">API Connection</span>
                            </div>
                            <div class="diagnostic-status" id="apiConnectionStatus">Click "Test Connection" to check</div>
                            <div class="diagnostic-details" id="apiConnectionDetails"></div>
                        </div>
                        
                        <div class="diagnostic-card">
                            <div class="diagnostic-header">
                                <i class="fas fa-key diagnostic-icon" id="authStatusIcon"></i>
                                <span class="diagnostic-title">Authentication</span>
                            </div>
                            <div class="diagnostic-status" id="authStatus">Click "Test Connection" to check</div>
                            <div class="diagnostic-details" id="authDetails"></div>
                        </div>
                        
                        <div class="diagnostic-card">
                            <div class="diagnostic-header">
                                <i class="fas fa-database diagnostic-icon" id="dataAccessIcon"></i>
                                <span class="diagnostic-title">Data Access</span>
                            </div>
                            <div class="diagnostic-status" id="dataAccessStatus">Click "Test Connection" to check</div>
                            <div class="diagnostic-details" id="dataAccessDetails"></div>
                        </div>
                        
                        <div class="diagnostic-card">
                            <div class="diagnostic-header">
                                <i class="fas fa-heartbeat diagnostic-icon" id="controllerHealthIcon"></i>
                                <span class="diagnostic-title">Controller Health</span>
                            </div>
                            <div class="diagnostic-status" id="controllerHealthStatus">Click "Test Connection" to check</div>
                            <div class="diagnostic-details" id="controllerHealthDetails"></div>
                        </div>
                    </div>
                    
                    <div class="connection-info" id="connectionInfo" style="display: none;">
                        <h3>Connection Details</h3>
                        <div class="info-grid" id="connectionDetails">
                            <!-- Connection details will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parental Controls Tab -->
        <div id="parental-tab" class="tab-content">
            <div class="parental-controls">
                <div class="parental-header">
                    <h2><i class="fas fa-user-shield"></i> Parental Controls</h2>
                    <div class="parental-actions">
                        <button id="addDeviceBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Device
                        </button>
                        <button id="refreshParentalBtn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="parental-stats">
                    <div class="stat-card">
                        <i class="fas fa-ban"></i>
                        <div class="stat-info">
                            <span class="stat-number" id="blockedDevicesCount">-</span>
                            <span class="stat-label">Blocked Devices</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-info">
                            <span class="stat-number" id="scheduledDevicesCount">-</span>
                            <span class="stat-label">Scheduled Devices</span>
                        </div>
                    </div>
                    <!-- Time limits removed - not realistic to enforce -->
                </div>

                <div class="managed-devices-section">
                    <h3>Managed Devices</h3>
                    <div id="managedDevicesGrid" class="managed-devices-grid">
                        <!-- Managed devices will be populated here -->
                    </div>
                </div>

                <div id="noManagedDevices" class="no-devices" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <p>No devices under parental control</p>
                    <small>Click "Add Device" to start managing devices</small>
                </div>
            </div>
        </div>

        </main>

        <footer>
            <p>Last scan: <span id="lastUpdated">-</span></p>
            <p>Monitoring for new devices every 30 seconds</p>
            <p class="version-info">Version: <span id="versionInfo">-</span></p>
        </footer>
    </div>

    <!-- Device Detail Modal -->
    <div class="modal" id="deviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Device Details</h3>
                <button class="close-btn" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Device details will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCloseBtn">Close</button>
                <button class="btn btn-primary" id="modalAcknowledgeBtn">Acknowledge Device</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <div class="config-status" id="configStatus">
                    <span class="config-indicator" id="configIndicator"></span>
                    <span class="config-text" id="configText">Checking...</span>
                </div>
                <button class="close-btn" id="closeSettingsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>UniFi Controller Configuration</h4>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="unifiHost">Controller Host/IP</label>
                            <input type="text" id="unifiHost" value="192.168.1.1" placeholder="192.168.1.1">
                        </div>
                        <div class="setting-item">
                            <label for="unifiPort">Port</label>
                            <input type="number" id="unifiPort" value="443" placeholder="443">
                        </div>
                        <div class="setting-item">
                            <label for="unifiUsername">Username</label>
                            <input type="text" id="unifiUsername" value="admin" placeholder="admin">
                        </div>
                        <div class="setting-item">
                            <label for="unifiPassword">Password</label>
                            <input type="password" id="unifiPassword" placeholder="Enter password">
                        </div>
                        <div class="setting-item">
                            <label for="unifiSite">Site Name</label>
                            <input type="text" id="unifiSite" value="default" placeholder="default">
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Application Settings</h4>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="appPort">Server Port</label>
                            <input type="number" id="appPort" value="3000" placeholder="3000">
                        </div>
                        <div class="setting-item">
                            <label for="scanInterval">Scan Interval (seconds)</label>
                            <input type="number" id="scanInterval" value="30" placeholder="30" min="10" max="300">
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Version Information</h4>
                    <div class="version-details" id="versionDetails">
                        <div class="loading">Loading version information...</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Logs</h4>
                    <div class="logs-container">
                        <div class="logs-header">
                            <span>Recent Application Logs</span>
                            <button id="refreshLogsBtn" class="btn btn-secondary btn-small">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="logs-content" id="logsContent">
                            <div class="loading-logs">Loading logs...</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="settingsCloseBtn">Cancel</button>
                <button class="btn btn-info" id="testSettingsBtn">Test Settings</button>
                <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Add Device to Parental Controls Modal -->
    <div class="modal" id="addDeviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Add Device to Parental Controls</h3>
                <button class="close-btn" id="closeAddDeviceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="device-selection">
                    <div class="device-filters">
                        <input type="text" id="deviceSearchInput" placeholder="Search by name, hostname, alias, MAC, IP, or vendor..." class="search-input">
                        <div class="filter-controls">
                            <select id="statusFilter" class="filter-select">
                                <option value="all">All Status</option>
                                <option value="online">Online Only</option>
                                <option value="offline">Offline Only</option>
                            </select>
                            <select id="connectionFilter" class="filter-select">
                                <option value="all">All Connections</option>
                                <option value="wifi">WiFi Only</option>
                                <option value="wired">Wired Only</option>
                            </select>
                            <select id="vendorFilter" class="filter-select">
                                <option value="all">All Vendors</option>
                                <!-- Vendor options will be populated dynamically -->
                            </select>
                            <button id="clearFiltersBtn" class="btn btn-small btn-secondary">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="device-count-info">
                        <span id="deviceCountInfo">Loading devices...</span>
                    </div>
                    <div id="availableDevicesList" class="available-devices-list">
                        <!-- Available devices will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="addDeviceCloseBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Device Management Modal -->
    <div class="modal" id="deviceManagementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="managementModalTitle"><i class="fas fa-cog"></i> Device Management</h3>
                <button class="close-btn" id="closeManagementModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="management-tabs">
                    <button class="management-tab active" data-tab="controls">Controls</button>
                    <button class="management-tab" data-tab="schedule">Schedule</button>
                    <button class="management-tab" data-tab="logs">Activity</button>
                </div>

                <!-- Controls Tab -->
                <div id="controls-tab" class="management-tab-content active">
                    <div class="control-section">
                        <h4>Quick Actions</h4>
                        <div class="control-buttons">
                            <button id="blockDeviceBtn" class="btn btn-danger">
                                <i class="fas fa-ban"></i> Block Device
                            </button>
                            <button id="unblockDeviceBtn" class="btn btn-success">
                                <i class="fas fa-check"></i> Unblock Device
                            </button>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h4>Temporary Block</h4>
                        <div class="time-input-group">
                            <input type="number" id="tempBlockMinutes" placeholder="Minutes" min="1" max="1440">
                            <button id="tempBlockBtn" class="btn btn-warning">
                                <i class="fas fa-clock"></i> Block Temporarily
                            </button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h4>Bonus Time</h4>
                        <div class="time-input-group">
                            <input type="number" id="bonusMinutes" placeholder="Minutes" min="5" max="480">
                            <button id="addBonusTimeBtn" class="btn btn-info">
                                <i class="fas fa-plus"></i> Add Bonus Time
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Schedule Tab -->
                <div id="schedule-tab" class="management-tab-content">
                    <div class="schedule-section">
                        <h4>Weekly Schedule</h4>
                        <div class="schedule-grid" id="scheduleGrid">
                            <!-- Schedule will be populated here -->
                        </div>
                        <button id="saveScheduleBtn" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Schedule
                        </button>
                    </div>
                </div>

                <!-- Activity Logs Tab -->
                <div id="logs-tab" class="management-tab-content">
                    <div class="activity-logs">
                        <h4>Recent Activity</h4>
                        <div id="deviceActivityLogs" class="activity-logs-list">
                            <!-- Activity logs will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="managementCloseBtn">Close</button>
                <button class="btn btn-danger" id="removeDeviceBtn">
                    <i class="fas fa-trash"></i> Remove from Parental Controls
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>